<!doctype html>
<html>
<head>
    <title>Gmail Settings - Tenant Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .gmail-list-item {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .gmail-address {
            font-family: monospace;
            font-size: 0.95rem;
            color: #495057;
        }
        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 2rem;
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            border: 2px dashed #dee2e6;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <!-- Header with back button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="bi bi-envelope"></i> Gmail Address Settings</h2>
            <p class="text-muted">Manage Gmail addresses for notifications and communications.</p>
        </div>
        <div class="d-flex align-items-center">
            <span class="me-3">
                <i class="bi bi-person-circle me-1"></i>
                Welcome, {{ current_user.username }}
            </span>
            <a href="/" class="btn btn-secondary me-2">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
            <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-box-arrow-right me-1"></i>Logout
            </a>
        </div>
    </div>

    <!-- Add new tenant-Gmail pair form -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="bi bi-plus-circle"></i> Add New Tenant & Gmail Address
            </h5>
        </div>
        <div class="card-body">
            <form method="post" action="/add_gmail">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="tenant_name" class="form-label">Tenant Name</label>
                        <input type="text" name="tenant_name" id="tenant_name"
                               placeholder="Enter tenant name (optional)" 
                               class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label for="gmail_address" class="form-label">Gmail Address</label>
                        <input type="email" name="gmail_address" id="gmail_address"
                               placeholder="Enter Gmail address (e.g., example@gmail.com)" 
                               pattern="[a-zA-Z0-9._%+-]+@gmail\.com"
                               title="Please enter a valid Gmail address"
                               class="form-control" 
                               required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Add Tenant & Gmail Address
                        </button>
                    </div>
                </div>
                <div class="form-text">
                    Only Gmail addresses (@gmail.com) are accepted. Tenant name is optional.
                </div>
            </form>
        </div>
    </div>

    <!-- Saved tenant-Gmail pairs list -->
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="bi bi-list-ul"></i> Saved Tenant & Gmail Addresses
                {% if settings and settings.tenant_gmail_pairs %}
                    <span class="badge bg-primary">{{ settings.tenant_gmail_pairs|length }}</span>
                {% endif %}
            </h5>
        </div>
        <div class="card-body">
            {% if settings and settings.tenant_gmail_pairs %}
                {% for pair in settings.tenant_gmail_pairs %}
                    <div class="gmail-list-item">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-person-fill text-success me-2"></i>
                            <div class="me-3">
                                {% if pair.tenant_name %}
                                    <div class="fw-bold text-dark">
                                        {{ pair.tenant_name }}
                                        {% if loop.first %}
                                            <span class="badge bg-primary ms-2">Sender Account</span>
                                        {% endif %}
                                    </div>
                                    <div class="gmail-address small">{{ pair.gmail_address }}</div>
                                {% else %}
                                    <div class="gmail-address">
                                        {{ pair.gmail_address }}
                                        {% if loop.first %}
                                            <span class="badge bg-primary ms-2">Sender Account</span>
                                        {% endif %}
                                    </div>
                                    <div class="small text-muted">No tenant name specified</div>
                                {% endif %}
                            </div>
                        </div>
                        <form method="post" action="/remove_gmail" style="display: inline;" 
                              onsubmit="return confirm('Are you sure you want to remove {{ pair.gmail_address }}{% if pair.tenant_name %} ({{ pair.tenant_name }}){% endif %}?');">
                            <input type="hidden" name="gmail_address" value="{{ pair.gmail_address }}">
                            <button type="submit" class="btn btn-sm btn-outline-danger" 
                                    title="Remove this tenant-Gmail pair">
                                <i class="bi bi-trash"></i> Remove
                            </button>
                        </form>
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-envelope-x display-4 text-muted mb-3"></i>
                    <h5 class="text-muted">No tenant-Gmail pairs saved</h5>
                    <p class="text-muted mb-0">Add your first tenant and Gmail address using the form above.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Information section -->
    <div class="mt-4">
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i>
            <strong>Information:</strong> Tenant names and Gmail addresses saved here can be used for future notifications and email communications related to tenant agreements and alerts. The tenant name is optional but helps identify the contact person.<br>
            <strong>Note:</strong> The <em>first Gmail address</em> in your list will be used as the sender when sending email alerts. Make sure your primary email account is listed first.
        </div>
    </div>
</div>
</body>
</html>
